---
alwaysApply: true
---
# Workflow TDD —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

> **–ë–∞–∑–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:** [vision.md](vision.md), [conventions.mdc](conventions.mdc), [qa_conventions.mdc](qa_conventions.mdc), [tasklist.md](tasklist.md)

## –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª TDD

### 1. –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏—Ç–µ—Ä–∞—Ü–∏–∏
- [ ] –ü—Ä–æ—á–∏—Ç–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∏–∑ [tasklist.md](tasklist.md)
- [ ] –ò–∑—É—á–∏—Ç—å —Ü–µ–ª—å –∏ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### 2. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è
**–ü–µ—Ä–µ–¥ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ–º –∫–æ–¥–∞:**
- [ ] –û–ø–∏—Å–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- [ ] –û–ø–∏—Å–∞—Ç—å **—Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** (—á—Ç–æ –±—É–¥–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è)
- [ ] –ü—Ä–∏–≤–µ—Å—Ç–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–ª–∞—Å—Å–æ–≤/—Ñ—É–Ω–∫—Ü–∏–π
- [ ] –£–∫–∞–∑–∞—Ç—å –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∏ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã
- [ ] **–î–æ–∂–¥–∞—Ç—å—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

**–§–æ—Ä–º–∞—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è:**
```
–ò—Ç–µ—Ä–∞—Ü–∏—è N: [–Ω–∞–∑–≤–∞–Ω–∏–µ]

–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. –°–æ–∑–¥–∞–º —Ç–µ—Å—Ç—ã: test_X –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Y
2. –†–µ–∞–ª–∏–∑—É—é —Ñ–∞–π–ª src/module.py —Å –∫–ª–∞—Å—Å–æ–º Z
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É—é –≤ —Ñ–∞–π–ª A

–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- –¢–µ—Å—Ç 1: –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –¢–µ—Å—Ç 2: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω–æ–≥–æ —Å–ª—É—á–∞—è
- –¢–µ—Å—Ç 3: –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

–ö–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã:
[–∫–æ–¥ —Å —Å–∏–≥–Ω–∞—Ç—É—Ä–∞–º–∏]

–û–¥–æ–±—Ä—è–µ—à—å?
```

### 3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (TDD –¶–∏–∫–ª)

#### –î–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏/–º–µ—Ç–æ–¥–∞:

**üî¥ RED - Failing Test**
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å failing —Ç–µ—Å—Ç –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –¢–µ—Å—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `make test` - —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–∏—á–∏–Ω–µ

**üü¢ GREEN - Minimal Implementation**
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
- [ ] –¶–µ–ª—å: –∑–∞—Å—Ç–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –ø—Ä–æ–π—Ç–∏, –Ω–µ –±–æ–ª—å—à–µ
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `make test` - —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ ‚úÖ
- [ ] –ù–µ –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ –∫—Ä–∞—Å–æ—Ç–µ –∫–æ–¥–∞ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ

**üîµ REFACTOR - Clean Code**
- [ ] –£–ª—É—á—à–∏—Ç—å –∫–æ–¥ (—É–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–ø—Ä–æ—Å—Ç–∏—Ç—å)
- [ ] –°–ª–µ–¥–æ–≤–∞—Ç—å [conventions.mdc](conventions.mdc)
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `make test` - —Ç–µ—Å—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –∑–µ–ª–µ–Ω—ã–º–∏ ‚úÖ
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `make lint` –∏ `make typecheck`

**üîÅ Repeat** –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏/–º–µ—Ç–æ–¥–∞

**–ü–æ—Å–ª–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ: –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∞
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `make quality` - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚úÖ

### 4. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –∏–∑ tasklist.md
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤—Å–µ–π —Ñ–∏—á–∏ end-to-end
- [ ] –°–æ–æ–±—â–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] **–î–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
**–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:**
- [ ] –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã –∑–∞–¥–∞—á –≤ tasklist.md
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (‚è≥ ‚Üí ‚úÖ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤ ‚è≥

### 6. –ö–æ–º–º–∏—Ç
**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞:**
```
feat: –∏—Ç–µ—Ä–∞—Ü–∏—è N - [–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]

- –∑–∞–¥–∞—á–∞ 1
- –∑–∞–¥–∞—á–∞ 2
- –∑–∞–¥–∞—á–∞ 3

–¢–µ—Å—Ç—ã: [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤] ‚úÖ
–ü–æ–∫—Ä—ã—Ç–∏–µ: [–ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–∫—Ä—ã—Ç–∏—è]
–ü—Ä–æ–≤–µ—Ä–∫–∏: make quality ‚úÖ
```

**–ü—Ä–∏–º–µ—Ä:**
```
feat: –∏—Ç–µ—Ä–∞—Ü–∏—è 2 - Database —Å SQLite

- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω Database –∫–ª–∞—Å—Å —Å async context manager
- –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã save_message, get_history, clear_history
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bot handlers

–¢–µ—Å—Ç—ã: 12 unit —Ç–µ—Å—Ç–æ–≤ ‚úÖ
–ü–æ–∫—Ä—ã—Ç–∏–µ: Database 95%
–ü—Ä–æ–≤–µ—Ä–∫–∏: make quality ‚úÖ
```

### 7. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `make quality` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª–µ–Ω—ã–µ ‚úÖ
- [ ] –°–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: "–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏ N?"
- [ ] **–î–æ–∂–¥–∞—Ç—å—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏—è**
- [ ] –ù–∞—á–∞—Ç—å —Å –ø—É–Ω–∫—Ç–∞ 1

---

## TDD –ü—Ä–∏–Ω—Ü–∏–ø—ã

### –¶–∏–∫–ª Red-Green-Refactor

```
üî¥ RED ‚Üí üü¢ GREEN ‚Üí üîµ REFACTOR ‚Üí üîÅ REPEAT
  ‚Üì         ‚Üì            ‚Üì
–¢–µ—Å—Ç      –ú–∏–Ω–∏–º—É–º     –£–ª—É—á—à–µ–Ω–∏–µ
–ø–∞–¥–∞–µ—Ç    –¥–ª—è         –ø—Ä–∏ –∑–µ–ª–µ–Ω—ã—Ö
          –ø—Ä–æ—Ö–æ–¥–∞     —Ç–µ—Å—Ç–∞—Ö
```

### –ü—Ä–∞–≤–∏–ª–∞ TDD

**üî¥ RED Phase:**
- –¢–µ—Å—Ç –ø–∏—à–µ—Ç—Å—è –ü–ï–†–í–´–ú, –¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å!)
- –û–¥–∏–Ω failing —Ç–µ—Å—Ç –∑–∞ —Ä–∞–∑
- –¢–µ—Å—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é

**üü¢ GREEN Phase:**
- –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
- –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å "–≥—Ä—è–∑–Ω—ã–π" –∫–æ–¥ (–ø–æ—Ç–æ–º –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–º)
- –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å "–ª–∏—à–Ω–µ–π" —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –¶–µ–ª—å: –∑–µ–ª–µ–Ω—ã–π —Ç–µ—Å—Ç, –Ω–µ –∏–¥–µ–∞–ª—å–Ω—ã–π –∫–æ–¥

**üîµ REFACTOR Phase:**
- –£–ª—É—á—à–∞–µ–º –∫–æ–¥ –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –¢–µ—Å—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –∑–µ–ª–µ–Ω—ã–º–∏ –≤—Å–µ–≥–¥–∞
- –ü—Ä–∏–º–µ–Ω—è–µ–º SOLID, DRY, KISS
- –ï—Å–ª–∏ —Ç–µ—Å—Ç —É–ø–∞–ª - –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º (—Å–ª–µ–¥—É–µ–º qa_conventions.mdc)

**‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º:**
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Ä–∞—Å—á–µ—Ç—ã, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏)
- API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (–º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—É—Ç–∏ (–æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (expected failures)

**‚ùå –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º:**
- –¢—Ä–∏–≤–∏–∞–ª—å–Ω—ã–π –∫–æ–¥ (–≥–µ—Ç—Ç–µ—Ä—ã/—Å–µ—Ç—Ç–µ—Ä—ã)
- –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã)
- –§—Ä–µ–π–º–≤–æ—Ä–∫/–±–∏–±–ª–∏–æ—Ç–µ–∫–∏

---

## –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### ‚ùå –ù–ï –¥–µ–ª–∞—Ç—å
- –ù–µ –ø–∏—Å–∞—Ç—å –∫–æ–¥ –¥–æ —Ç–µ—Å—Ç–∞ (–Ω–∞—Ä—É—à–µ–Ω–∏–µ TDD)
- –ù–µ –ø–∏—Å–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ failing —Ç–µ—Å—Ç–æ–≤ —Å—Ä–∞–∑—É
- –ù–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –ø—Ä–∏ –∫—Ä–∞—Å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
- –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å `make test` –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏
- –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å failing —Ç–µ—Å—Ç—ã

### ‚úÖ –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å
- –ü–∏—Å–∞—Ç—å failing —Ç–µ—Å—Ç –ø–µ—Ä–≤—ã–º (RED)
- –ó–∞–ø—É—Å–∫–∞—Ç—å `make test` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã
- –ö–æ–º–º–∏—Ç–∏—Ç—å –ø—Ä–∏ –∑–µ–ª–µ–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
- –°–ª–µ–¥–æ–≤–∞—Ç—å [qa_conventions.mdc](qa_conventions.mdc)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å `make quality` –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º

### üí¨ –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
- –°–æ–æ–±—â–∞—Ç—å —Ñ–∞–∑—É TDD —Ü–∏–∫–ª–∞: "üî¥ RED: –ø–∏—à—É —Ç–µ—Å—Ç –¥–ª—è X"
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã `make test` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã
- –ö—Ä–∞—Ç–∫–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
- –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤ - —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—ã–≤–æ–¥
- **–õ—É—á—à–µ –ø–µ—Ä–µ—Å–ø—Ä–æ—Å–∏—Ç—å, —á–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç**

### üîÑ –ï—Å–ª–∏ —Ç–µ—Å—Ç —É–ø–∞–ª
- **–í RED —Ñ–∞–∑–µ:** —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–π
- **–í GREEN —Ñ–∞–∑–µ:** –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
- **–í REFACTOR —Ñ–∞–∑–µ:** –æ—Ç–∫–∞—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –≤–µ—Ä–Ω–∏—Å—å –∫ –∑–µ–ª–µ–Ω—ã–º —Ç–µ—Å—Ç–∞–º
- **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** –æ—Å—Ç–∞–Ω–æ–≤–∏—Å—å, –ø–æ–∫–∞–∂–∏ –æ—à–∏–±–∫—É, –∏—Å–ø—Ä–∞–≤—å

---

## –ü—Ä–∏–º–µ—Ä TDD —Ü–∏–∫–ª–∞

```
[Code Assistant]
–ò—Ç–µ—Ä–∞—Ü–∏—è 2: Database –∫–ª–∞—Å—Å

–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. tests/test_database.py - —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
2. src/storage/database.py - Database –∫–ª–∞—Å—Å
3. src/storage/models.py - Message –º–æ–¥–µ–ª—å

–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- test_save_message_user: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ user —Å–æ–æ–±—â–µ–Ω–∏—è
- test_get_history_empty: –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–∏
- test_get_history_limit: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- test_clear_history: –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏

–û–¥–æ–±—Ä—è–µ—à—å?

[User]
–î–∞

[Code Assistant]
üî¥ RED: –ü–∏—à—É test_save_message_user

```python
async def test_save_message_user(db):
    msg = Message(user_id=123, chat_id=123, role="user", content="Hello")
    await db.save_message(msg)
    
    history = await db.get_history(chat_id=123, user_id=123)
    assert len(history) == 1
    assert history[0].content == "Hello"
```

–ó–∞–ø—É—Å–∫–∞—é make test...
‚ùå FAILED: AttributeError: 'Database' object has no attribute 'save_message'

üü¢ GREEN: –†–µ–∞–ª–∏–∑—É—é –º–∏–Ω–∏–º—É–º –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è

```python
class Database:
    async def save_message(self, message: Message) -> None:
        # –ü—Ä–æ—Å—Ç–µ–π—à–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
        await self._connection.execute(
            "INSERT INTO messages (user_id, chat_id, role, content) VALUES (?, ?, ?, ?)",
            (message.user_id, message.chat_id, message.role, message.content)
        )
```

–ó–∞–ø—É—Å–∫–∞—é make test...
‚úÖ PASSED test_save_message_user

üîµ REFACTOR: –£–ª—É—á—à–∞—é –∫–æ–¥

- –î–æ–±–∞–≤–∏–ª type hints
- –î–æ–±–∞–≤–∏–ª docstring
- –î–æ–±–∞–≤–∏–ª error handling

–ó–∞–ø—É—Å–∫–∞—é make test...
‚úÖ PASSED test_save_message_user

üîÅ REPEAT: –ü–µ—Ä–µ—Ö–æ–∂—É –∫ test_get_history_empty

[... –ø–æ–≤—Ç–æ—Ä—è—é —Ü–∏–∫–ª –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ ...]

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã:
‚úÖ test_save_message_user
‚úÖ test_get_history_empty
‚úÖ test_get_history_limit
‚úÖ test_clear_history

–ó–∞–ø—É—Å–∫–∞—é make quality...
‚úÖ format
‚úÖ lint
‚úÖ typecheck
‚úÖ test (4 passed)

–ü–æ–∫—Ä—ã—Ç–∏–µ Database: 92%

–ì–æ—Ç–æ–≤–æ –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é.

[User]
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª, —Ä–∞–±–æ—Ç–∞–µ—Ç

[Code Assistant]
–û—Ç–ª–∏—á–Ω–æ! –û–±–Ω–æ–≤–ª—è—é tasklist.md:
- –ò—Ç–µ—Ä–∞—Ü–∏—è 2: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ (2024-10-11)

–ö–æ–º–º–∏—Ç:
feat: –∏—Ç–µ—Ä–∞—Ü–∏—è 2 - Database —Å SQLite

–¢–µ—Å—Ç—ã: 4 unit —Ç–µ—Å—Ç–æ–≤ ‚úÖ
–ü–æ–∫—Ä—ã—Ç–∏–µ: Database 92%
–ü—Ä–æ–≤–µ—Ä–∫–∏: make quality ‚úÖ

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏ 3?
```

---

## –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

### TDD —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –î–û —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏–ª —á–µ—Ä–µ–∑ RED ‚Üí GREEN ‚Üí REFACTOR
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] `make test` - –≤—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª–µ–Ω—ã–µ ‚úÖ

### –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] –í—Å–µ –∑–∞–¥–∞—á–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- [ ] `make quality` - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚úÖ
- [ ] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç conventions.mdc –∏ qa_conventions.mdc
- [ ] tasklist.md –æ–±–Ω–æ–≤–ª–µ–Ω (—Å—Ç–∞—Ç—É—Å, –¥–∞—Ç–∞)
- [ ] –ü–æ–ª—É—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## –ú–µ—Ç—Ä–∏–∫–∏ TDD

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**
- –¢–µ—Å—Ç—ã: 100% –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ
- –ü–æ–∫—Ä—ã—Ç–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏: >80%
- –õ–∏–Ω—Ç–µ—Ä/—Ç–∏–ø—ã: 0 –æ—à–∏–±–æ–∫

**–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ TDD:**
- –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –±—ã–ª —Å–Ω–∞—á–∞–ª–∞ RED (falling)
- –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–º–µ–µ—Ç —Ö–æ—Ç—è –±—ã 1 —Ç–µ—Å—Ç
- –¢–µ—Å—Ç—ã —á–∏—Ç–∞–µ–º—ã –∏ –ø–æ–Ω—è—Ç–Ω—ã
- –¢–µ—Å—Ç—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
