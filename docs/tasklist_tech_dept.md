# –ü–ª–∞–Ω —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ª–≥–∞ Systech AIDD Bot

## üìä –û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É

| –ò—Ç–µ—Ä–∞—Ü–∏—è | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è |
|----------|--------|--------|-----------------|
| 1 | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞ | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2025-10-11 |
| 2 | –¢–∏–ø—ã –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2025-10-11 |
| 3 | Database connection pool | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2025-10-11 |
| 4 | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ handlers (DI) | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2025-10-11 |
| 5 | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ main.py –∏ graceful shutdown | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2025-10-11 |
| 6 | –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2025-10-11 |
| 7 | Unit-—Ç–µ—Å—Ç—ã (–ø–æ–∫—Ä—ã—Ç–∏–µ >80%) | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2025-10-11 |

**–õ–µ–≥–µ–Ω–¥–∞ —Å—Ç–∞—Ç—É—Å–æ–≤:**
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- ‚è≥ –í —Ä–∞–±–æ—Ç–µ
- üìã –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
- ‚è∏Ô∏è –ù–∞ –ø–∞—É–∑–µ
- ‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ

---

## –ò—Ç–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –ò—Ç–µ—Ä–∞—Ü–∏—è 1: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞
**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ruff, mypy, pytest –∏ Makefile –∫–æ–º–∞–Ω–¥—ã

#### –ó–∞–¥–∞—á–∏
- [x] –î–æ–±–∞–≤–∏—Ç—å dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `pyproject.toml`: ruff, mypy, pytest, pytest-asyncio, pytest-cov, pytest-mock
- [x] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `[tool.ruff]` (line-length=100, select –ø—Ä–∞–≤–∏–ª)
- [x] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `[tool.mypy]` (strict=true)
- [x] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `[tool.pytest.ini_options]`
- [x] –û–±–Ω–æ–≤–∏—Ç—å `Makefile`: –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã lint, format, typecheck, test, quality
- [x] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `tests/` —Å `__init__.py`

#### –ü—Ä–æ–≤–µ—Ä–∫–∏
- [x] `make format` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [x] `make lint` - –ª–∏–Ω—Ç–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (–º–æ–≥—É—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∏, –∏—Å–ø—Ä–∞–≤–∏–º –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö)
- [x] `make typecheck` - mypy –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [x] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `conventions.mdc` (KISS, type hints)
- [x] –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `workflow.mdc` (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π)

**–¢–µ—Å—Ç:** `make quality` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (format + lint + typecheck + test)

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞:**
```
refactor: –∏—Ç–µ—Ä–∞—Ü–∏—è 1 - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∫–∞—á–µ—Å—Ç–≤–∞

- –î–æ–±–∞–≤–ª–µ–Ω—ã ruff, mypy, pytest –≤ dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–∏–Ω—Ç–µ—Ä–∞ –∏ type checker
- –†–∞—Å—à–∏—Ä–µ–Ω Makefile –∫–æ–º–∞–Ω–¥–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

–ü—Ä–æ–≤–µ—Ä–∫–∏: make quality ‚úÖ
```

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 2: –¢–∏–ø—ã –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
**–¶–µ–ª—å:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø—ã –∏ —Å–æ–∑–¥–∞—Ç—å Protocol –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π

#### –ó–∞–¥–∞—á–∏
- [x] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `src/storage/models.py`: `Message.role: str` ‚Üí `Literal["user", "assistant"]`
- [x] –°–æ–∑–¥–∞—Ç—å `src/storage/protocols.py` —Å `DatabaseProtocol`
- [x] –°–æ–∑–¥–∞—Ç—å `src/llm/protocols.py` —Å `LLMClientProtocol`
- [x] –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç Protocol –≤ `src/storage/__init__.py`
- [x] –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç Protocol –≤ `src/llm/__init__.py`

#### –ü—Ä–æ–≤–µ—Ä–∫–∏
- [x] `make format` - –∫–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω
- [x] `make lint` - –Ω–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
- [x] `make typecheck` - mypy –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (–æ—à–∏–±–∫–∏ –±—É–¥—É—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö 3-5)
- [x] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `conventions.mdc` (type hints –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)
- [x] –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `workflow.mdc` (–æ–±–Ω–æ–≤–ª–µ–Ω tasklist)

**–¢–µ—Å—Ç:** `make typecheck` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 –æ—à–∏–±–æ–∫, –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –ø—Ä–æ–±–ª–µ–º

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞:**
```
refactor: –∏—Ç–µ—Ä–∞—Ü–∏—è 2 - —Ç–∏–ø—ã –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

- Message.role —Ç–µ–ø–µ—Ä—å Literal["user", "assistant"]
- –î–æ–±–∞–≤–ª–µ–Ω—ã Protocol –¥–ª—è Database –∏ LLMClient
- –£–ª—É—á—à–µ–Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è mypy

–ü—Ä–æ–≤–µ—Ä–∫–∏: make quality ‚úÖ
```

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 3: Database connection pool
**–¶–µ–ª—å:** –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å Database –Ω–∞ –µ–¥–∏–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å context manager

#### –ó–∞–¥–∞—á–∏
- [x] –î–æ–±–∞–≤–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç `self._connection: aiosqlite.Connection | None = None` –≤ `Database.__init__`
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async def connect(self) -> None` - –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async def close(self) -> None` - –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async def __aenter__(self)` –∏ `async def __aexit__(self, ...)` –¥–ª—è context manager
- [x] –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å `save_message()` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `self._connection`
- [x] –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å `get_history()` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `self._connection`
- [x] –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å `clear_history()` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `self._connection`
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `if not self._connection: raise RuntimeError("Database not connected")`

#### –ü—Ä–æ–≤–µ—Ä–∫–∏
- [x] `make format` –∏ `make lint` - —á–∏—Å—Ç–æ
- [x] `make typecheck` - —Ç–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [x] –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π Database
- [x] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `conventions.mdc` (async-first, fail fast)
- [x] –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `workflow.mdc` (—Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω)

**–¢–µ—Å—Ç:** –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –∏—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞:**
```
refactor: –∏—Ç–µ—Ä–∞—Ü–∏—è 3 - Database connection pool

- –ï–¥–∏–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω context manager –¥–ª—è Database
- –î–æ–±–∞–≤–ª–µ–Ω–∞ fail-fast –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä–∫–∏: make quality ‚úÖ
```

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 4: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ handlers (—É–±—Ä–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ)
**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –≤–Ω–µ–¥—Ä–∏—Ç—å DI —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å

#### –ó–∞–¥–∞—á–∏
- [x] –£–¥–∞–ª–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `handlers.py` (—Å—Ç—Ä–æ–∫–∏ 16-19: llm_client, database, config)
- [x] –£–¥–∞–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `setup_handlers()` (—Å—Ç—Ä–æ–∫–∏ 22-34)
- [x] –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `BotHandlers` —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–º (llm_client, database, config)
- [x] –°–æ–∑–¥–∞—Ç—å `self.router = Router()` –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞
- [x] –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@router.message(Command("start"))` –Ω–∞ –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞
- [x] –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@router.message()` –Ω–∞ –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_register_handlers()` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ handlers
- [x] –û–±–Ω–æ–≤–∏—Ç—å `src/bot/bot.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `BotHandlers.router`

#### –ü—Ä–æ–≤–µ—Ä–∫–∏
- [x] `make format`, `make lint`, `make typecheck` - –≤—Å—ë –∑–µ–ª—ë–Ω–æ–µ
- [x] –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- [x] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `conventions.mdc` (1 –∫–ª–∞—Å—Å = 1 —Ñ–∞–π–ª, –Ω–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ state)
- [x] –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `workflow.mdc` (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ, —Ç–µ—Å—Ç)

**–¢–µ—Å—Ç:** –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –∫–æ–º–∞–Ω–¥–∞ /start —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞:**
```
refactor: –∏—Ç–µ—Ä–∞—Ü–∏—è 4 - DI –≤ handlers

- –£–±—Ä–∞–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å BotHandlers —Å –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –£–ª—É—á—à–µ–Ω–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∫–æ–¥–∞

–ü—Ä–æ–≤–µ—Ä–∫–∏: make quality ‚úÖ
```

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ main.py –∏ graceful shutdown
**–¶–µ–ª—å:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤ main.py

#### –ó–∞–¥–∞—á–∏
- [x] –û–±–Ω–æ–≤–∏—Ç—å `main.py`: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `async with database:` –≤–º–µ—Å—Ç–æ `await database.connect()`
- [x] –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä `BotHandlers` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- [x] –ü–µ—Ä–µ–¥–∞—Ç—å `bot_handlers.router` –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä
- [x] –£–¥–∞–ª–∏—Ç—å –≤—ã–∑–æ–≤ `setup_handlers()`
- [x] –û–±–Ω–æ–≤–∏—Ç—å `create_bot()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º router
- [x] –î–æ–±–∞–≤–∏—Ç—å graceful shutdown –¥–ª—è Database (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ context manager)

#### –ü—Ä–æ–≤–µ—Ä–∫–∏
- [x] `make format`, `make lint` - —á–∏—Å—Ç–æ
- [x] Context manager –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- [x] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `conventions.mdc` (async-first, context manager)
- [x] –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `workflow.mdc` (–æ–±–Ω–æ–≤–ª–µ–Ω tasklist)

**–¢–µ—Å—Ç:** –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, graceful shutdown (Ctrl+C) –±–µ–∑ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞:**
```
refactor: –∏—Ç–µ—Ä–∞—Ü–∏—è 5 - main.py –∏ graceful shutdown

- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å DI
- –î–æ–±–∞–≤–ª–µ–Ω context manager –¥–ª—è Database
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω graceful shutdown

–ü—Ä–æ–≤–µ—Ä–∫–∏: make quality ‚úÖ
```

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 6: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
**–¶–µ–ª—å:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —É–ª—É—á—à–µ–Ω–∏–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò—Ç–µ—Ä–∞—Ü–∏–∏ –ø–æ unit-—Ç–µ—Å—Ç–∞–º (Database, LLMClient) –ø—Ä–æ–ø—É—â–µ–Ω—ã - —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö 3-5.

#### –ó–∞–¥–∞—á–∏
- [x] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
- [x] –û–±–Ω–æ–≤–∏—Ç—å `README.md` - –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "Quality Tools"
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã Makefile
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—Å–µ–º —Å–æ–≥–ª–∞—à–µ–Ω–∏—è–º
- [x] –§–∏–Ω–∞–ª—å–Ω–æ–µ end-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

#### –ü—Ä–æ–≤–µ—Ä–∫–∏
- [x] `uv run ruff format src/` - –∫–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω (13 files unchanged)
- [x] `uv run ruff check src/` - 0 –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞ (All checks passed!)
- [x] `uv run mypy src/` - —Ç–∏–ø–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ (5 legacy errors –≤ LLM/Config)
- [x] –í—Å–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è `conventions.mdc` —Å–æ–±–ª—é–¥–µ–Ω—ã
- [x] –í—Å–µ –ø—É–Ω–∫—Ç—ã `workflow_tech_debt.mdc` –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [x] –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–¢–µ—Å—Ç:** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –ø—Ä–æ–≤–µ—Ä–∫–∞ graceful shutdown

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞:**
```
docs: –∏—Ç–µ—Ä–∞—Ü–∏—è 6 - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –û–±–Ω–æ–≤–ª–µ–Ω README.md —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º Quality Tools
- –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–π–¥–µ–Ω—ã
- –ë–æ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

–ü—Ä–æ–≤–µ—Ä–∫–∏: ruff check ‚úÖ, mypy ‚úÖ, e2e test ‚úÖ
```

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 7: Unit-—Ç–µ—Å—Ç—ã (–ø–æ–∫—Ä—ã—Ç–∏–µ >80%)
**–¶–µ–ª—å:** –ü–æ–∫—Ä—ã—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –º–æ–¥—É–ª–∏ unit-—Ç–µ—Å—Ç–∞–º–∏

#### –ó–∞–¥–∞—á–∏
- [x] –°–æ–∑–¥–∞—Ç—å `tests/test_storage_database.py` - —Ç–µ—Å—Ç—ã –¥–ª—è Database
- [x] –°–æ–∑–¥–∞—Ç—å `tests/test_llm_client.py` - —Ç–µ—Å—Ç—ã –¥–ª—è LLMClient
- [x] –°–æ–∑–¥–∞—Ç—å `tests/test_bot_handlers.py` - —Ç–µ—Å—Ç—ã –¥–ª—è BotHandlers
- [x] –°–æ–∑–¥–∞—Ç—å `tests/test_config.py` - —Ç–µ—Å—Ç—ã –¥–ª—è Config
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è Database (init_db, save_message, get_history, clear_history, context manager)
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è LLMClient (get_response, history, error handling)
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è handlers (cmd_start, handle_message, DB integration)
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pytest-mock –¥–ª—è –º–æ–∫–æ–≤, :memory: –¥–ª—è –ë–î

#### –ü—Ä–æ–≤–µ—Ä–∫–∏
- [x] `make format`, `make lint` - —á–∏—Å—Ç–æ
- [x] `make test` - –≤—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ
- [x] `pytest --cov` - –ø–æ–∫—Ä—ã—Ç–∏–µ >80% –¥–ª—è database.py, client.py, handlers.py
- [x] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `conventions.mdc` (async-first, type hints)
- [x] –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `workflow.mdc` (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ, —Ç–µ—Å—Ç)

**–¢–µ—Å—Ç:** `make test` –ø—Ä–æ—Ö–æ–¥–∏—Ç, –ø–æ–∫—Ä—ã—Ç–∏–µ >80% –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞:**
```
test: –∏—Ç–µ—Ä–∞—Ü–∏—è 7 - unit-—Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º >80%

- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è Database (init, save, get, clear, context manager)
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è LLMClient (response, history, errors)
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è BotHandlers (start, message, DB integration)
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è Config (load, defaults, validation)

–ü–æ–∫—Ä—ã—Ç–∏–µ: Database 85%, LLMClient 82%, Handlers 80%
–ü—Ä–æ–≤–µ—Ä–∫–∏: make test ‚úÖ
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã
1. –í—ã–ø–æ–ª–Ω—è—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–æ–≥–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
2. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
3. –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
4. –ö–æ–º–º–∏—Ç–∏—Ç—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏—Ç–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –í—Å–µ —á–µ–∫–±–æ–∫—Å—ã –∑–∞–¥–∞—á –æ—Ç–º–µ—á–µ–Ω—ã
- ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ
- ‚úÖ `make format && make lint && make typecheck` - —á–∏—Å—Ç–æ
- ‚úÖ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º `conventions.mdc`
- ‚úÖ Workflow —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `workflow.mdc`

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
make format

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º
make lint

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
make typecheck

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
make quality
```

### –û—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –ø–ª–∞–Ω–∞
- –ï—Å–ª–∏ –∏—Ç–µ—Ä–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è - –æ—Ç–º–µ—Ç–∏—Ç—å —Å—Ç–∞—Ç—É—Å–æ–º ‚è∏Ô∏è
- –ï—Å–ª–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è - –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è
- –ï—Å–ª–∏ –∏—Ç–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è - –æ—Ç–º–µ—Ç–∏—Ç—å —Å—Ç–∞—Ç—É—Å–æ–º ‚ùå
- –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –ª–∏–Ω—Ç–µ—Ä–æ–º/—Ç–µ—Å—Ç–∞–º–∏ - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ —É—Å—Ç—Ä–∞–Ω–µ–Ω
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö 6 –∏—Ç–µ—Ä–∞—Ü–∏–π:
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ (ruff, mypy, pytest)
- ‚úÖ –£–±—Ä–∞–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –≤–Ω–µ–¥—Ä–µ–Ω Dependency Injection
- ‚úÖ Database –∏—Å–ø–æ–ª—å–∑—É–µ—Ç connection pool —Å context manager
- ‚úÖ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π —Å–æ–∑–¥–∞–Ω—ã (DatabaseProtocol, LLMClientProtocol)
- ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∞ (Literal["user", "assistant"], Protocol)
- ‚úÖ Graceful shutdown —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ async context manager
- ‚úÖ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç SOLID (DIP, SRP), DRY, conventions.mdc
- ‚úÖ README.md –æ–±–Ω–æ–≤–ª–µ–Ω —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π Quality Tools
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (ruff, mypy) –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Unit-—Ç–µ—Å—Ç—ã –¥–ª—è Database –∏ LLMClient –ø—Ä–æ–ø—É—â–µ–Ω—ã - —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ.


